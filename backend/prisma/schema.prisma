generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

//
// ENUMS
//

enum UserRole {
  ADMIN
  BUSINESS
}

enum BusinessStatus {
  ACTIVE
  INACTIVE
}

enum ItemType {
  PRODUCT
  SERVICE
}

enum ItemStatus {
  ACTIVE
  INACTIVE
}

//
// MODELOS
//

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  password    String
  role        UserRole

  businessId  String?
  business    Business? @relation(fields: [businessId], references: [id])

  createdAt   DateTime @default(now())

  @@index([businessId])
}

model Business {
  id             String         @id @default(uuid())
  name           String
  slug           String         @unique
  fiscalId       String
  phoneWhatsapp  String
  logoUrl        String?
  status         BusinessStatus @default(ACTIVE)
  inactivatedAt  DateTime?

  users          User[]
  items          Item[]

  createdAt      DateTime @default(now())
}

model Item {
  id               String      @id @default(uuid())
  businessId       String
  business         Business    @relation(fields: [businessId], references: [id])

  type             ItemType
  status           ItemStatus  @default(ACTIVE)

  name             String
  price            Decimal     @db.Decimal(10,2)
  description      String?

  // Solo para servicios
  durationMinutes  Int?

  images           ItemImage[]

  createdAt        DateTime @default(now())

  @@index([businessId])
  @@index([type])
}

model ItemImage {
  id      String @id @default(uuid())
  itemId  String
  item    Item   @relation(fields: [itemId], references: [id], onDelete: Cascade)

  url     String
  order   Int

  @@index([itemId])
}